# Todos

- [x] Command: instead of storing data changes, store commands
- [x] Database: load command records into database
- [x] Add: update database based on a Command
- [x] Add: create CommandRecord from CLI parameters
- [x] Add: append new CommandRecord to database
- [x] Main: save CommandRecord to disk
- [x] Main: list tasks
- [x] List: prefix title with parent list name
- [x] Add: store creation time for item
- [x] Database: index the tasks which are pending
- [x] Main: 'mod' command
- [x] Mod: modify item properties
- [x] List: check off task if it's completed
- [x] List: use esqueleto
- [x] Database: create an item table for wide-format data
- [x] List: list of lists and their components
- [x] Database: only set 'index' property on 'Item'
- [x] Add: only use Property table for list properties and non-standard properties
- [x] Add: find parent by uuid, index, label
- [x] Change license to GPL3
- [x] Put git repository on github
- [x] Mod: move function to Add.hs and refactor them
- [x] Mod: only use Property table for list properties and non-standard properties
- [x] Import: import from task warrior json and save a single file containing all the commands
- [x] Database: add fields for start time, end time, close time, due time
- [x] Import: handle close time
- [x] List: parameter 'from=TIME' hides any items which were closed before the given TIME
- [x] Set type and title in optsProcess2_add
- [x] Implement 'close' command
- [x] Import
   - [x] update Import.hs for new use of CmdArgs
   - [x] create CmdArgs Options
   - [x] update Main.hs
   - [x] test it
- [x] Lookup tradeoffs for String, Text, ByteString, as well as the lazy and strict versions.
- [x] List: get it working again with CmdArgs
- [x] Main: shouldn't print help when no args or flags are given; individual commands could do that though
- [x] Import: set cmd to 'mod' for modifications
- [x] Mod: setup 'mod' command, especially for import
- [x] Rebuild: delete database before importing
- [x] Rebuild: make sure commands get directed to the appropriate handlers
- [x] List: display label and title of lists
- [x] List: assign indexes to non-list items and save these in the db
- [x] Mod: get it to work from the cli
- [x] List: display by stage
- [x] List: display by status
- [x] create parser for item indexes with commas and dashes (look at parsec)
- [x] Let 'mod' accept multiple references
- [x] List: list tasks for a given list
- [x] Rename 'list' command to 'show'
- [x] Show: shows tags
- [x] Show: --hide-tags suppresses display of tag
- [x] Show: --tag to show items specific tags
- [x] Import: import tags
- [x] Mod: allow for removing tags by prefixing them with '-'
- [x] Delete: create command
- [x] Import: create proper uuids for projects rather than use name
- [x] Show: --search for text in title
- [x] Show: show items which aren't on any list (i.e., don't have a parent)
- [x] Rebuild: delete command rows too
- [x] Rebuild: why isn't delete command record getting saved in DB?
- [x] Mod: 'parent' need to be a valid reference
- [x] Show: fix --stage
- [x] Close: let it interpret id ranges like Mod
- [ ] Add: autogenerate a label for lists if none is given
- [ ] Check out hlint
- [ ] Read chapters 15 and 18 of Real World Haskell
- [ ] Add: when run from command line, give task the next available index and print it out
- [ ] Show: remove parentheses around index and print extra spacing so that items are aligned
- [ ] Show: --show-context, --show-stage
- [ ] Show: --no-tag to filter out items with given tags
- [ ] Show: --by-stages to group the output by stages, and if stages are specified only using the given stages and display them in the given order
- [ ] Show: --by-tags to group the output by stages, and if stages are specified only using the given stages and display them in the given order
- [ ] Show: 'lists' argument to just show lists -- preferably show them hierarchially then?
- [ ] Mod: get '--tag' to work, if it doesn't already
- [ ] Show: show by stages
- [ ] Show: when listing with '--parent=ID', also list sublists of the given parent
- [ ] Show: --type for just listing lists, for example
- [ ] NumberList: accept '/' and other symbols in identifiers
- [ ] Add: due date
- [ ] Import: due date
- [ ] Args: make upd1 and updN functions, where upd1 updates the map and ensures only once instance of the flag
- [ ] Show: --orphans for items without parents
- [ ] Show: --emptylists for lists without children
- [ ] Main: 'stage' command
- [ ] Main: 'tag' command
- [ ] Possible commands: task, list, note, event, file, search, report, order, calendar, pomodoros, kanban
- [ ] Switch from String to Text and make sure umlauts are printed correctly
- [ ] For the CmdArgs modes, consider creating two for each command: one for standard parameter plus command-line-only parameters, and one with standard parameters plus internal-only parameters (e.g. 'id')
- [ ] Close: don't close an already closed item
- [ ] Main: use the 'format' parameter of CommandRecord to choose which function handles the command record
- [ ] Rename Args.hs to Modes.hs or Options.hs
- [ ] Move source files into appropriate module hierarchy
- [ ] Add: maybe refToUuid shouldn't be called while constructing the CommandRecord in order to leave labels as they are
- [ ] Refactor.  See what can be merged among Main, Import, and Rebuild.
- [ ] Add: think about putting list paths into 'Property' tables for finding lists by path and detecting duplicates
- [ ] Database: add fields for priority
- [ ] List: prefix with start time
- [ ] List: prefix with end time
- [ ] List: list tasks for a given list
- [ ] List: show tags
- [ ] List: show contexts
- [ ] List: show age
- [ ] List: show comments
- [ ] Add: find parent by title too (case insensitive)
- [ ] Main: list tasks which have a field matching a string
- [ ] Main: list tasks with specific fields, i.e. --stage=inbox
- [ ] DatabaseTables: Switch to using UTCTime
- [ ] Main: when setting parent, prevent cyclic loops -- might want to check this in loadDB too.
- [ ] Command: save UTCTime with more precision?
- [ ] Instead of `IO (Validation ())`, should I use `Validation (IO ())` or make a `ValidationT`?
- [ ] Main: accept `--debug` flag to print debug output, but suppress it otherwise
- [ ] Reopen: add command to reopen closed and deleted items
- [ ] create a parser for convenient specification of dates
- [ ] Add/Mod: when an item is added with `--status=closed` or `--closed=DATE`, make sure both values get set in optsProcess2_add/mod
- [ ] Create my own parser for command lines to allow for ``otot add "my happy task" stage=today tag+happy``
- [ ] label references shouldn't be not turned into uuids for CommandRecord
- [ ] Command line for specifying config file or root directory

When creating a new item from the commandline:

- [x] Options read by CmdArgs
- [x] Options are validated and processed
- [x] Options convert to CommandRecord
- [ ] CommandRecord saved to a temporary file
- [ ] CommandRecord read in from file
- [ ] Verify that CommandRecords are equal
- [x] CommandRecord converted to Command
- [x] Command saved to DB
- [ ] Command loaded from DB
- [ ] Verify that Commands are equal
- [ ] Command converted to a CommandRecord
- [ ] Verify that CommandRecords are equal
- [ ] CommandRecord converted to Options
- [ ] Verify that Options are equal
- [x] Options are validated and processed for modification of DB 'item' and 'property' tables
- [x] items and properties are updated
- [ ] if anything went wrong, remove the Command entry and rebuild
- [ ] if everything went well, move the CommandRecord file to the appropriate path

Important lists:
- [ ] everything
- [ ] just tasks for a given list/tag/context
- [ ] all items for a given list/tag/context
- [ ] pomodoro day report
- [ ] kanban report
- [ ] calendar report
- [ ] goals/beeminder report
- [ ] urgent/imporant report

Config file:
- [ ] Create a YAML config file
- [ ] Default arguments for commands, such as the default stage for new tasks
- [ ] Customized stages
- [ ] Directories for data
- [ ] Directory to place local data
- [ ] Username
- [ ] Temporary directory

## Incubator tasks

- [ ] 'command undo' command deleting the last local command from the history
- [ ] 'command history' command to list all commands given so far (perhaps filtering out old closed items)
- [ ] 'command ignore' command for ignoring a command when rebuilding the database
- [ ] repl
- [ ] interactive mode to handle ambiguities
- [ ] interactive mode possibly for adding new item
- [ ] web UI

## Old
- [x] Change: switch to new JSON format
- [x] Change: Give clearer names to the Change* types
- [x] Create new change record files
- [x] Change: loadDB: load multiple files
- [x] Change: loadDB: load all json files in direcory
- [x] Change: Switch to using UTCTime in Change.hs
- [x] Main: Get current time for change records
- [x] Change: Convert Change* types to JSON
- [x] Main: Generate UUID for new change records
- [x] Change: remove unnecessary elements from JSON output
- [x] Main: save change record to disk
