# Todos

## Export

- [x] change 'uuid' to 'id'
- [x] change 'stage' to 'horizon'
- [?] change 'status=deleted' to 'deleted=true'
- [x] remove 'status'
- [ ] load and export tags
- [ ] change 'parent' to 'folder', with appropriate transformation

## View command

Sample command:

    view "(and tag=mustdo status=open stage=today,next)"
    view "(and status=open estimate<30)"

- [x] allow for operators other than `=`, such as `<=` for `estimate<=2`
- [x] print items
- [x] print headings for item groups
- [x] add blank lines before folder heading if it's not the first line
- [x] PatchDatabase.patch: to accept a Bool for whether find the max index in database and use that plus 1 for new items.
- [x] remove indexNext from Env
- [x] fix crash when running view query
- [x] update indexes of displayed items for 'view' command
- [x] view with no parameters should list everything (currently `view "(and )"` works)
- [ ] figure out how to list a folder (look at View.constructViewQuery)
- [ ] recurse into children
- [ ] sort items (currently need to add "item." prefix where appropriate)
      In View.view, build the "ORDER BY" string using the appropriate prefixes?
      Or maybe better to build the ORDER string in actionFromOptions?
- [ ] let user specify how to group items
- [ ] color the checkboxes according to stage
- [ ] PatchDatabase.patch: should print the patched items

- [ ] add Horizon/Stage table
- [ ] automatically populate the Horizon table with Persistent
- [ ] use the Horizon table to sort by horizon/stage

## Design 3

Ideas:
- Rename 'title' -> 'content'?
- Rename 'label' -> 'name'? But maybe we still want to have global labels?
- Should term for the hierarchical parent be: parent, path, directory, or folder?
- make a terminal-like repl for: cd, cat, mv, ln, ls, find, mkdir, rmdir as well as special commands like new, close, show, mod

- [x] Create a REPL
- [x] Add: option -F, automatically create required folders
- [x] Repl: create CmdArgs Options for ls, mkdir
- [x] Repl: convert Options to Action
- [x] Repl: convert Action to CommandRecord arguments
- [x] Repl: ls: don't display recursively unless `-R` flag
- [x] mkdir: consider automatically creating a root folder with uuid = 0's
- [x] Repl: ``ls``: should display items in current folder
- [x] Repl: newtask
- [x] mode_newtask should be ActionNewTask instead of Options
- [x] Repl: create CommandRecord when appropriate for actions
- [x] Repl: ``ls -R``: should display items in current folder, then recursively for each item, with proper relative paths
- [x] Repl: ``ls`` should put blank lines between folder listings
- [x] Repl: add some color to ``ls``
- [x] Item: add name, creator
- [x] Rename Card to Patch
- [x] Repl: newitem should return a diff, like mkdir
- [x] Repl: ``cat`` action should print item as yaml
- [x] Import: create a yaml file instead
- [x] Main: manually parse arguments for now: import
- [x] Main: manually parse arguments for now: repl
- [x] Import: create folder items when required
- [x] Item: rename ``ctime`` to ``created``
- [x] Create a yaml import format (ExportFile)
- [x] Rebuild: get it to work with YAML ExportFile
- [x] Rebuild: process Event records to create Items and Properties
- [x] Import: assign ``name`` to folders
- [x] Import: sort output by time
- [x] Create a PatchFile1 that sets new values without comparing old values, and make it work with Rebuild
- [x] Repl: save PathFile1 as json in the ``testdata`` directory for commands which create patches
- [x] ExportFile: why is version not in the JSON?
- [x] rename "export" => "copy" in Event and ExportFile
- [x] Repl: show
- [x] Repl: add ``close`` command
- [x] BUG: See why ``close`` sets the created date
- [x] Repl: mv to change name
- [x] Repl: don't abort on unknown command
- [x] Repl: mv to change parent
- [x] Import: export tags
- [x] Rebuild: handle tags
- [x] Run.hs: move sharable code to a new Utils.hs file
- [x] patch: create property rows
- [x] Repl: add ``mod`` command
- [x] patch: I think it's turning ``itemIndex`` to nothing, but it should leave the index alone
- [x] Repl: implement remaining ``mod`` options
- [x] Main: write files using UTC date for filename prefix
- [x] Repl: add ``--delete`` option to ``close`` command
- [x] Main: refactor repl actions to remove some code duplication
- [x] Mod: bug: crashes on ``mod 272 -s month 273``
- [x] Go through my personal list of tasks and update it, seeing what needs to be added to program
- [x] get rid of esqueleto dependency so that I can hopefully get workable dependencies on my laptop
- [x] test: create a git repository for syncing my lists
- [x] start working on calendar
- [x] Repl: newtask: add --start parameter 
- [x] Repl: change mode_newtask to create Options instead of ActionNewtask
- [x] Repl: newtask: add --tag parameter 
- [x] Repl: newtask: add parameter shortcuts (/work = -p work, +mustdo = -t mustdo)
- [x] Show: calendar: space before date (except the first)
- [x] Repl: newtask: add --end parameter 
- [x] Show: calendar: show weekday after date
- [x] Show: calendar: show start and end time
- [x] Repl: mod: add end parameters, and everything else newtask accepts
- [x] Repl: color the ``otot>`` prompt
- [x] Rebuild: create the root folder too
- [x] Mod: let user remove tags
- [x] Rebuild: handle diff "-tag XXX"
- [x] Show: sort lists alphabetically and fix display of some lists as items
- [x] Repl: cat: let user pass index too
- [x] Repl: add `due` to newtask and mod
- [x] Show: due date (figure out why it's not working)
- [x] Mod: add 'due' field to Diff
- [x] Show: handle formats such as "${title 'missing' 'prefix' 'infix' 'suffix'}"
- [x] Show: tasks: display start, end, due dates
- [x] Repl: newtask: default to null stage when stage is irrelevant
- [x] Show: let user specify subfolder, e.g. ``show -p /work/primers``
- [x] Show: read in template file
- [x] Show: create sample template files to test ``show template``
- [x] Show: for ``show -p /work/primers``, don't display directories / and /work
- [x] Repl: cd
- [x] Show: show stage
- [x] Show template: don't restart indexes from 1 for each call to show
- [x] see whether I can get good command line interaction with history and cursor movements for Haskell
- [x] Repl: cd: should be able to switch to another absolute path (e.g. from /edu to /work)
- [x] Repl: cd: should be able to use relative paths
- [x] Repl: cd: should be able to use '..'
- [x] Add field for time estimate
- [ ] Newtask: handle `estimate` option
- [ ] Mod: use `-e` for estimate field
- [ ] Handle more fields in view element parser, such as 'status'
- [ ] BUG: 'show template' isn't preserving index settings anymore
- [ ] Figure out VIEW concept (working on View.hs and ViewParser.hs)
   - query: ANDs and ORs, along with flags
   - item print format
   - ordering
   - headers
   - variable substitution, so that I can easily list same conditions but with different horizons?
   - can accept multiple such lists, making sure that first index isnn't overwritten when listing items multiple times
   - (stage=today and folder=/edu with --non-recursive) or (...)
- [ ] Repl: mod/newtask: ``-s -`` and ``-s ''`` should remove stage
- [ ] Repl: mod/newtask: Use '?' shortcut for stage
- [ ] Repl: make 'rebuild' command available from the repl
- [ ] Repl: newtask: BUG: when in a folder below the root, should still be able to create item in a folder given its absolute path
- [ ] Show: convert it from a Command to an Action
- [ ] item indexes should probably have it's own table, since it really has nothing to do with the item
- [ ] day planning template: show items on today's calendar
- [ ] day planning template: let user show all ?today items and also show any items from ?next or ?week up to a total of N items (minus the ?today items)
- [ ] day planning template: automatically move scheduled items to ?today
- [ ] day planning template: mark automatically moved items as "new" or with some form of alert
- [ ] Newtask: why does this produce an error:
        /work/roboliq > newtask "Ask Johannes how time critical the operations are, due to problems with multipipetting and the small tips" /work/stflow
        No such file or directory
- [ ] Show: use cwd as default parent
- [ ] Show: should be recursive by default, with a --no-recurse option to suppress recursion
- [ ] Show: ``show inbox`` should list items with folder in title rather than as a header
- [ ] Haskeline: use autocompletion for commands and parameters
- [ ] Show: Use '?' shortcut for stage
- [ ] Rename stage to horizon, parent to folder
- [ ] Repl: edit: create edit command to edit lists and template contents
- [ ] Actions.Utils: refactor to create a logical set of functions to lookup a paths, including parsing or number ranges and comma-separated lists
- [ ] Show: handle sub-tasks
- [ ] Show: handle showing item hierarchy in general, not just tasks (e.g. notes)
- [ ] Show: if an item gets shown twice, use the first index each time rather than assigning a new index
- [ ] need to think about sub-types
  - [ ] for example, a task to spend a certain amount of time on a task
  - [ ] a task to do something for a "do-more" goal
  - [ ] task to work on a project, perhaps with a subset of project tasks
- [ ] Repl: mod: add everything newtask accepts, including special args such as '+mustdo'
- [ ] How to best schedule something for tomorrow?  Defer?  Start?
- [ ] Item: create special database parser for Time, so that the time fields can be Times instead of Strings
- [ ] Time: create timeToLocalTime function
- [ ] Create a ``waiting`` command to move a task to the waiting stage and remove
- [ ] Show: calendar: show nicer start and end time
- [ ] Show: show start and end time for tasks too, not just calendar
- [ ] Main: add current time zone to Env
- [ ] Repl: newtask: add -P parameter to create folder if it doesn't exist 
- [ ] Config: load config file on program startup
- [ ] Config: load data directory, load sqlite filename
- [ ] Repl: handle "smart dates" as user input (see <http://hackage.haskell.org/package/hledger-0.5.1/docs/src/Ledger-Dates.html>)
- [ ] Repl: add some coloring to prompt and errors
- [ ] Show: bug: folder names are sometimes listed multiple times
- [ ] Show: bug: empty folders shouldn't be listed normally
- [ ] Show: ``oldest`` report, which orders from oldest to newest
- [ ] Figure out how to handle multi-day events -- maybe have a ``template`` field that refers to the first part, and just modifies some fields
- [ ] Show: ``-n`` options to limit number of tasks to display, in particular for listing items in some order (such as oldest first)
- [ ] add ``--defer`` option to ``newtask`` and ``mod``, and create corresponding report
- [ ] Repl: ``newtask`` should output a CopyFile instead of a PatchFile
- [ ] A "horizon"/"stage" should have a numeric value, so they can be ordered.  I want the program to know that ?today is sooner than ?week.
- [ ] Stages
   - it should be possible for the user to define custom stages
   - standard stages are as follows:
   - queues: inbox, today, next
   - review: adaptive, week, month, quarter, year
   - calendars: due, event, deferred
   - project
   - reference
   - other: closed, deleted
   - if something is on the calendar, it needs a date
   - if something is deferred, it needs a defer date
   - might want to track the duration that an item has spent in a queue
   - an item which has a defer date automatically gets staged in "deferred", but should still show up in grey-out color on the due or schedule calendar, if it has the relevant dates
   - an item which has a due date automatically becomes a project, and the user should say how long beforehand the project should show up as an active project
   - an item which has a start date (but no due date) automatically goes on the schedule
   - probably need to have 'date' and 'time' fields instead of just 'time' fields in Item, since we need to distinguish being an item being scheduled for a given day vs being scheduled at midnight on a given day
- [ ] Figure out REVIEW concept:
      - daily review, weekly review, monthly review, quarterly review, yearly review
            - using lists?
            - the problem with lists is that I'd like to make sure that every task is on some review schedule
            - so add a ``reviewList`` field to Item
      - on a certain date
            - add a ``reviewTime`` field to Item
      - regular review, e.g. for study like Anki
            - this requires some more work...
            - might want to keep history for each question/response
            - depending on response, calculate when to review again
      - a task is either in "new", "now", a queue (today, week), or review (similar to "stages", but perhaps each item should have a field for each characteristic; but maybe queue and review are mutually exclusive)
      - example report: shows new, now, queues
      - example report: new, review items, then items which are not in queues; ordered by project
- [ ] Figure out TICKET concept
      - perhaps tasks should all be tickets
      - they need to have history of changes and updates
      - need to support back-and-forth between multiple users
- [ ] Figure out CALENDAR concept
   - it should be possible to display projects and goals on the calendar too
   - it should be possible to display deferred events on the calendar in grey-out color
- [ ] Figure out REPEATING TASK concept
- [ ] Figure out TIME TRACKING/ESTIMATION/POMODORO concept
      - "tasklist" checkable item for grouping together tasks without making them children of the item?
- [ ] Figure out GOAL concept, where an item can be marked as done for today, but will still come up later
- [ ] Figure out SHOPPING LIST concept
      - in addition to the item, we need to specify quantity or other specifics
      - maybe this could be a "shop" item with an extra quantity property
- [ ] Figure out SCHEDULE concept (i.e. Dora's schedule with kids and me)
- [ ] Figure out AGENDA concept (how to flag project items for particular agendas)
- [ ] Action.Utils: organize functions, better names, stop using path chains?  Env should have IDs of repositories (e.g. map of mount path to repo information)?
- [ ] Repl: ``ls`` should sort output, directories first, and everything alphabetically
- [ ] Repl: ``show`` should share code with ls
- [ ] Main: if data directory is in a git repository, auto-add the file
- [ ] Main: if data directory is in a git repository, auto-commit and auto-push the changes
- [ ] Item: consider renaming ItemForJson to Item, and separating more between Sqlite model and the data
- [ ] Ask online whether it's possible to search a (Maybe String) field with esqueleto
- [ ] Repl: add ``rm`` command as alias for ``close --delete``?
- [ ] Report bug with Yaml/Aeson, where a string of digits (e.g. "name: 20130509") causes an error when being read back in
- [ ] Rename ``Import`` to ``Convert``
- [ ] instead of using "otot.db" or "repl.db", get file from the options and have a default value
- [ ] PatchFile2: Consider having DiffEqual, DiffNull, and DiffRemove also contain the old values
- [ ] create a common function for creating an item, whether via mkdir or newtask.
- [ ] find type of UUID and use that instead of String
- [ ] Item: add assignee field
- [ ] Rebuild: use new commands
- [ ] Rebuild: add an option to build from internal event table or reload the event table from files
- [ ] Edit my data in 'testdata' to create folders instead of lists; also no use of 'label'
- [ ] Rebuild: create root folder, perhaps use code from ``getroot`` in Run.hs
- [ ] Repl: ls -l
- [ ] Repl: ls -a
- [ ] Repl: ``ls -R`` should prefix everything with '/'
- [ ] Repl: cat, to show low-level details, perhaps YAML or MD
- [ ] Repl: ln
- [ ] Item: remove label field once I've transitioned everything to use 'name' instead
- [ ] Add: rename to new?
- [ ] Add: option -F,--newfolder to create a folder with the given name if not already present
- [ ] Add support for folders, taking the place of the old list concept
- [ ] ``uuidRoot`` should not be all zeros: generate a root UUID somehow, probably need to have it in a config file in the data directory
- [ ] Add support for lists as an ordered sequence of items
- [ ] Show: decide how to handle AND vs OR queries for tags and contexts
- [ ] consider using pretty JSON output for file output, especially for ``import``
- [ ] Show: calendar: somehow let user choose which items to show on calendar which are assigned to someone else
- [ ] Want to put alerts on items, such that email is sent out or phone buzzes if task isn't done by a certain time

## Design 2
- [x] Command: instead of storing data changes, store commands
- [x] Database: load command records into database
- [x] Add: update database based on a Command
- [x] Add: create CommandRecord from CLI parameters
- [x] Add: append new CommandRecord to database
- [x] Main: save CommandRecord to disk
- [x] Main: list tasks
- [x] List: prefix title with parent list name
- [x] Add: store creation time for item
- [x] Database: index the tasks which are pending
- [x] Main: 'mod' command
- [x] Mod: modify item properties
- [x] List: check off task if it's completed
- [x] List: use esqueleto
- [x] Database: create an item table for wide-format data
- [x] List: list of lists and their components
- [x] Database: only set 'index' property on 'Item'
- [x] Add: only use Property table for list properties and non-standard properties
- [x] Add: find parent by uuid, index, label
- [x] Change license to GPL3
- [x] Put git repository on github
- [x] Mod: move function to Add.hs and refactor them
- [x] Mod: only use Property table for list properties and non-standard properties
- [x] Import: import from task warrior json and save a single file containing all the commands
- [x] Database: add fields for start time, end time, close time, due time
- [x] Import: handle close time
- [x] List: parameter 'from=TIME' hides any items which were closed before the given TIME
- [x] Set type and title in optsProcess2_add
- [x] Implement 'close' command
- [x] Import
   - [x] update Import.hs for new use of CmdArgs
   - [x] create CmdArgs Options
   - [x] update Main.hs
   - [x] test it
- [x] Lookup tradeoffs for String, Text, ByteString, as well as the lazy and strict versions.
- [x] List: get it working again with CmdArgs
- [x] Main: shouldn't print help when no args or flags are given; individual commands could do that though
- [x] Import: set cmd to 'mod' for modifications
- [x] Mod: setup 'mod' command, especially for import
- [x] Rebuild: delete database before importing
- [x] Rebuild: make sure commands get directed to the appropriate handlers
- [x] List: display label and title of lists
- [x] List: assign indexes to non-list items and save these in the db
- [x] Mod: get it to work from the cli
- [x] List: display by stage
- [x] List: display by status
- [x] create parser for item indexes with commas and dashes (look at parsec)
- [x] Let 'mod' accept multiple references
- [x] List: list tasks for a given list
- [x] Rename 'list' command to 'show'
- [x] Show: shows tags
- [x] Show: --hide-tags suppresses display of tag
- [x] Show: --tag to show items specific tags
- [x] Import: import tags
- [x] Mod: allow for removing tags by prefixing them with '-'
- [x] Delete: create command
- [x] Import: create proper uuids for projects rather than use name
- [x] Show: --search for text in title
- [x] Show: show items which aren't on any list (i.e., don't have a parent)
- [x] Rebuild: delete command rows too
- [x] Rebuild: why isn't delete command record getting saved in DB?
- [x] Mod: 'parent' need to be a valid reference
- [x] Show: fix --stage
- [x] Close: let it interpret id ranges like Mod

- [ ] Add: autogenerate a label for lists if none is given
- [ ] Check out hlint
- [ ] Read chapters 15 and 18 of Real World Haskell
- [ ] Add: when run from command line, give task the next available index and print it out
- [ ] Show: remove parentheses around index and print extra spacing so that items are aligned
- [ ] Show: --show-context, --show-stage
- [ ] Show: --no-tag to filter out items with given tags
- [ ] Show: --by-stages to group the output by stages, and if stages are specified only using the given stages and display them in the given order
- [ ] Show: --by-tags to group the output by stages, and if stages are specified only using the given stages and display them in the given order
- [ ] Show: 'lists' argument to just show lists -- preferably show them hierarchially then?
- [ ] Mod: get '--tag' to work, if it doesn't already
- [ ] Show: show by stages
- [ ] Show: when listing with '--parent=ID', also list sublists of the given parent
- [ ] Show: --type for just listing lists, for example
- [ ] NumberList: accept '/' and other symbols in identifiers
- [ ] Import: due date
- [ ] Args: make upd1 and updN functions, where upd1 updates the map and ensures only once instance of the flag
- [ ] Show: --orphans for items without parents
- [ ] Show: --emptylists for lists without children
- [ ] Main: 'stage' command
- [ ] Main: 'tag' command
- [ ] Possible commands: task, list, note, event, file, search, report, order, calendar, pomodoros, kanban
- [ ] Switch from String to Text and make sure umlauts are printed correctly
- [ ] For the CmdArgs modes, consider creating two for each command: one for standard parameter plus command-line-only parameters, and one with standard parameters plus internal-only parameters (e.g. 'id')
- [ ] Close: don't close an already closed item
- [ ] Main: use the 'format' parameter of CommandRecord to choose which function handles the command record
- [ ] Rename Args.hs to Modes.hs or Options.hs
- [ ] Move source files into appropriate module hierarchy
- [ ] Add: maybe refToUuid shouldn't be called while constructing the CommandRecord in order to leave labels as they are
- [ ] Refactor.  See what can be merged among Main, Import, and Rebuild.
- [ ] Add: think about putting list paths into 'Property' tables for finding lists by path and detecting duplicates
- [ ] Database: add fields for priority
- [ ] List: prefix with start time
- [ ] List: prefix with end time
- [ ] List: list tasks for a given list
- [ ] List: show tags
- [ ] List: show contexts
- [ ] List: show age
- [ ] List: show comments
- [ ] Add: find parent by title too (case insensitive)
- [ ] Main: list tasks which have a field matching a string
- [ ] Main: list tasks with specific fields, i.e. --stage=inbox
- [ ] DatabaseTables: Switch to using UTCTime
- [ ] Main: when setting parent, prevent cyclic loops -- might want to check this in loadDB too.
- [ ] Command: save UTCTime with more precision?
- [ ] Instead of `IO (Validation ())`, should I use `Validation (IO ())` or make a `ValidationT`?
- [ ] Main: accept `--debug` flag to print debug output, but suppress it otherwise
- [ ] Reopen: add command to reopen closed and deleted items
- [ ] create a parser for convenient specification of dates
- [ ] Add/Mod: when an item is added with `--status=closed` or `--closed=DATE`, make sure both values get set in optsProcess2_add/mod
- [ ] Create my own parser for command lines to allow for ``otot add "my happy task" stage=today tag+happy``
- [ ] label references shouldn't be not turned into uuids for CommandRecord
- [ ] Command line for specifying config file or root directory

When creating a new item from the commandline:

- [x] Options read by CmdArgs
- [x] Options are validated and processed
- [x] Options convert to CommandRecord
- [ ] CommandRecord saved to a temporary file
- [ ] CommandRecord read in from file
- [ ] Verify that CommandRecords are equal
- [x] CommandRecord converted to Command
- [x] Command saved to DB
- [ ] Command loaded from DB
- [ ] Verify that Commands are equal
- [ ] Command converted to a CommandRecord
- [ ] Verify that CommandRecords are equal
- [ ] CommandRecord converted to Options
- [ ] Verify that Options are equal
- [x] Options are validated and processed for modification of DB 'item' and 'property' tables
- [x] items and properties are updated
- [ ] if anything went wrong, remove the Command entry and rebuild
- [ ] if everything went well, move the CommandRecord file to the appropriate path

Important lists:
- [ ] everything
- [ ] just tasks for a given list/tag/context
- [ ] all items for a given list/tag/context
- [ ] pomodoro day report
- [ ] kanban report
- [ ] calendar report
- [ ] goals/beeminder report
- [ ] urgent/imporant report

Config file:
- [ ] Create a YAML config file
- [ ] Default arguments for commands, such as the default stage for new tasks
- [ ] Customized stages
- [ ] Directories for data
- [ ] Directory to place local data
- [ ] Username
- [ ] Temporary directory

## Incubator tasks
- [ ] 'command undo' command deleting the last local command from the history
- [ ] 'command history' command to list all commands given so far (perhaps filtering out old closed items)
- [ ] 'command ignore' command for ignoring a command when rebuilding the database
- [ ] repl
- [ ] interactive mode to handle ambiguities
- [ ] interactive mode possibly for adding new item
- [ ] web UI
- [ ] instead of have commands alter the database, they should create a diff, and the diff should then be applied -- could be difficult for complex commands (such a importing a bunch of items) which involve multiple inter-related items
- [ ] import annotations from Task Warrior

## Design 1
- [x] Change: switch to new JSON format
- [x] Change: Give clearer names to the Change* types
- [x] Create new change record files
- [x] Change: loadDB: load multiple files
- [x] Change: loadDB: load all json files in direcory
- [x] Change: Switch to using UTCTime in Change.hs
- [x] Main: Get current time for change records
- [x] Change: Convert Change* types to JSON
- [x] Main: Generate UUID for new change records
- [x] Change: remove unnecessary elements from JSON output
- [x] Main: save change record to disk
