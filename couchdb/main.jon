{"_id":"_design/main","_rev":"29-5b5d8d6e8dec3e29a0af86029ab5d9cb","language":"javascript","views":{"schedule":{"map":"function(doc) {\n  if (doc.type === \"scheduleItem\") {\n    emit([doc.user, doc.date, doc.parentId, doc.index], doc);\n  }\n}"},"items":{"map":"function(doc) {\n  if (doc.type === \"patch\") {\n    emit([doc.id, doc.mtime], {rectype: \"patch\", data: doc});\n  }\n  else if (doc.type === \"snapshot\") {\n    for (var j in doc.items) {\n      var item = doc.items[j];\n      emit([item.id, doc.ctime], {rectype: \"snapshot\", data: item});\n    }\n  }\n  else if (doc.type === \"task\") {\n    emit([doc._id], {rectype: \"rev\", rev: doc._rev});\n  }\n}","reduce":"function(keys, values) {\n  //var n = values.length;\n  var x = { rectype: \"none\", data: {} };\n  var rev = 0;\n  for (var i in values) {\n    var value = values[i];\n    if (value.rectype === \"patch\") {\n      if (x['rectype'] === \"snapshot\") {\n        for (var j in value.data.diffs) {\n          var diff = value.data.diffs[j];\n          if (diff[0] === \"=\") {\n            var name = diff[1];\n            x[name] = diff[2];\n          }\n        }\n      }\n      else if (x['rectype'] === \"patch\") {\n        x['data'].diffs = x['data'].diffs.concat(value.data.diffs);\n      }\n      else if (x['rectype'] === \"none\") {\n        x['rectype'] = \"patch\";\n        x['data'] = value.data;\n      }\n      x.data.mtime = value.mtime;\n    }\n    else if (value.rectype === \"snapshot\") {\n      x['rectype'] = \"snapshot\";\n      x['data'] = value.data;\n      x.data.mtime = value.mtime;\n    }\n    else if (value.rectype === \"rev\") {\n      rev = value.rev;\n    }\n  }\n\n  if (keys) {\n    var mtime = \"\";\n    for (var i = 0; i < keys.length; i++) {\n      if (keys[i][0].length == 2) {\n        var mtime2 = keys[i][0][1];\n        if (mtime2 > mtime)\n          mtime = mtime2;\n      }\n    }\n    if (mtime) {\n      x.data.mtime = mtime;\n    }\n  }\n\n  if (rev) {\n    x.data._rev = rev;\n  }\n\n  return x;\n}"}},"lists":{"openTasks":"function(head, req) { send('tasks:'); var first = true; while (row = getRow()) { var value = row.value; if (value.rectype === 'snapshot' && !value.data.closed) { if (first) send(\"\\n\"); else send(\",\\n\"); first = false; send(JSON.stringify(value.data)); } }; send('}\\n'); }"}}
