<!DOCTYPE html>
<head>
	<meta charset='utf-8'>
	<script src="bower_components/jquery/dist/jquery.js"></script>
	<script src="bower_components/jquery.hotkeys/jquery.hotkeys.js"></script>
	<script src="bower_components/jquery-ui/jquery-ui.js"></script>
	<script src="bower_components/underscore/underscore.js"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
	<style>
		.field-folder {
			color: blue;
		}
		.field-horizon {
			color: #008080;
		}
	</style>
</head>
<body unresolved>
	<div id="main">
		Headers: <input id="headers" type="text" value="folder">
		Order by: <input id="order" type="text" value="created">
		Query: <input id="query" type="text" value="">
		<input id = "btnList" type="submit" value="List"/>
		<br>
		Pages:
		<input id = "btnPageProjects" type="submit" value="Projects"/>
		<input id = "btnPageMustdos" type="submit" value="Mustdos"/>
		|
		<input id = "btnPageInbox" type="submit" value="Inbox"/>
		<input id = "btnPageToday" type="submit" value="Today"/>
		<input id = "btnPageNext" type="submit" value="Next"/>
		<input id = "btnPageWeek" type="submit" value="Week"/>
		<input id = "btnPageMonth" type="submit" value="Month"/>
		<input id = "btnPageQuarter" type="submit" value="Quarter"/>
		<input id = "btnPageYear" type="submit" value="Year"/>
		<br>
		<input id="rdoCurrent" name="rdoArchived" type="radio" checked> Current</input>
		<input id="rdoArchived" name="rdoArchived" type="radio"> Current+Archived</input>
		<input id="rdoArchivedOnly" name="rdoArchived" type="radio"> Archived</input>
		|
		<input id="btnArchive" type="submit" value="Archive"/>
		<br>
		<ul id="list"></ul>
	</div>

	<div id="dialog-new-form" title="Create a new todo" style="display: none">
		<form>
			<fieldset>
				<label for="newItemTitle">Title:</label>
				<input name="newItemTitle" id="newItemTitle" type="text" value="">
				<br>

				<label for="newItemFolder">Folder:</label>
				<input name="newItemFolder" id="newItemFolder" type="text" value="">
				<br>

				<label for="newItemHorizon">Horizon:</label>
				<select name="newItemHorizon" id="newItemHorizon">
					<option value="inbox">inbox</option>
					<option value="today">today</option>
					<option value="next">next</option>
					<option value="week">week</option>
					<option value="month">month</option>
					<option value="quarter">quarter</option>
					<option value="year">year</option>
				</select>
				<br>

				<label for="newItemTags">Tags:</label>
				<input name="newItemTags" id="newItemTags" type="text" value="">

				<input type="submit" tabindex="-1" value="Close" style="position: absolute; top: -1000px"/>
			</fieldset>
		</form>
	</div>

	<div id="dialog-edit-form" title="Enter index of item to edit" style="display: none">
		<label for="editItemIndex">Item Index:</label>
		<input name="editItemIndex" id="editItemIndex" type="text" value="">
		<input id = "btnEditIndex" type="submit" value="Load"/>
		<form>
			<fieldset>
				<label for="editItemTitle">Title:</label>
				<input name="editItemTitle" id="editItemTitle" type="text" value="">
				<br>

				<label for="editItemFolder">Folder:</label>
				<input name="editItemFolder" id="editItemFolder" type="text" value="">
				<br>

				<label for="editItemHorizon">Horizon:</label>
				<select name="editItemHorizon" id="editItemHorizon">
					<option value="inbox">inbox</option>
					<option value="today">today</option>
					<option value="next">next</option>
					<option value="week">week</option>
					<option value="month">month</option>
					<option value="quarter">quarter</option>
					<option value="year">year</option>
				</select>
				<br>

				<label for="editItemTags">Tags:</label>
				<input name="editItemTags" id="editItemTags" type="text" value="">
				<input type="submit" tabindex="-1" value="Close" style="position: absolute; top: -1000px"/>
			</fieldset>
		</form>
	</div>

	<div id="dialog-close-form" title="Mark items as closed" style="display: none">
		<p>Enter the item IDs you would like to close.</p>
		<form>
			<fieldset>
				<label for="closeList">Items:</label>
				<input name="closeList" id="closeList" type="text" value="">
				<br>

				<input type="submit" tabindex="-1" value="Close" style="position: absolute; top: -1000px"/>
			</fieldset>
		</form>
	</div>

	<div id="dialog-delete-form" title="Mark items as deleted" style="display: none">
		<p>Enter the item IDs you would like to delete.</p>
		<form>
			<fieldset>
				<label for="deleteList">Items:</label>
				<input name="deleteList" id="deleteList" type="text" value="">
				<br>

				<input type="submit" tabindex="-1" value="Delete" style="position: absolute; top: -1000px"/>
			</fieldset>
		</form>
	</div>

	<script src="main.js"></script>

	<script type="text/javascript">
		var dialog, form, editItem;

		function runList(h, o, q) {
			return function () {
				$("#headers").val(h);
				$("#order").val(o);
				$("#query").val(q);
				doList();
			};
		}
		$(document).ready(function(){
			$("#btnList").click(function(){ doList(); });
			$("#btnPageProjects").click(runList("folder", "horizon,created", ""));
			$("#btnPageMustdos").click(runList("horizon,folder", "created", '[["->", "tag", "mustdo"]]'));
			$("#btnPageInbox").click(runList("horizon,folder", "created", '[["=", "horizon", "new"]]'));
			$("#btnPageToday").click(runList("horizon,folder", "created", '[["=", "horizon", "today"]]'));
			$("#btnPageNext").click(runList("horizon,folder", "created", '[["=", "horizon", "next"]]'));
			$("#btnPageWeek").click(runList("horizon,folder", "created", '[["=", "horizon", "week"]]'));
			$("#btnPageMonth").click(runList("horizon,folder", "created", '[["=", "horizon", "month"]]'));
			$("#btnPageQuarter").click(runList("horizon,folder", "created", '[["=", "horizon", "quarter"]]'));
			$("#btnPageYear").click(runList("horizon,folder", "created", '[["=", "horizon", "year"]]'));
			$("#btnEditIndex").click(function() {
				var s = $("#editItemIndex").val();
				var index = parseInt(s);
				var item = item_m[index];
				editItem = item;
				if (item) {
					$("#editItemTitle").val(item.title);
					$("#editItemHorizon").val(item.horizon);
					if (item.folder) $("#editItemFolder").val(item.folder.join("/"));
					if (item.tags) $("#editItemTags").val(item.tags.join(" "));
				}
				else {
					alert("Invalid index: "+index);
				}
			});
			$("#btnArchive").click(doArchive);

			function prepareDialog(id, buttonLabel, fnSubmit) {
				var buttons, dialog, form;
				buttons = {};
				buttons[buttonLabel] = function() {
					fnSubmit();
					dialog.dialog("close");
				};
				buttons["Cancel"] = function() {
					dialog.dialog("close");
				};
				dialog = $(id).dialog({
					autoOpen: false,
					closeOnEscape: true,
					height: "250",
					modal: true,
					buttons: buttons,
					close: function() {
						form[0].reset();
					}
				});

				form = dialog.find("form").on("submit", function(e) {
					e.preventDefault();
					fnSubmit();
					dialog.dialog("close");
				});

				return dialog;
			}

			dialogNew = prepareDialog("#dialog-new-form", "Create", doCreateNew);
			dialogClose = prepareDialog("#dialog-close-form", "Close Items", doCloseN);
			dialogDelete = prepareDialog("#dialog-delete-form", "Delete Items", doDeleteN);
			dialogEdit = prepareDialog("#dialog-edit-form", "Edit", doEdit);

			$(document).bind('keydown.c', function() {
				$("#closeList").val("");
				dialogClose.dialog("open");
				return false;
			});

			$(document).bind('keydown.d', function() {
				$("#deleteList").val("");
				dialogDelete.dialog("open");
				return false;
			});

			$(document).bind('keydown.e', function() {
				dialogEdit.dialog("open");
				return false;
			});

			$(document).bind('keydown.n', function() {
				dialogNew.dialog("open");
				return false;
			});
		})

	</script>
</body>
